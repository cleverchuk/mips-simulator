/*
 * MIT License
 *
 * Copyright (c) 2022 CleverChuk
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software",0x0), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

package com.cleverchuk.mips.simulator.binary;

import java.util.Arrays;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

public enum Opcode {
  // ARITHMETIC OPERATIONS
  ADD("add", 0x00, 0x0000020, 0x00007e0),
  ADDI("addi", 0x20, 0x0, 0x0),
  ADDIU("addiu", 0x24, 0x0, 0x0),
  ADDIUPC("addiupc", 0xec, 0x0, 0x0018000),//FIXME: new
  ADDU("addu", 0x00, 0x0000021, 0x00007c1),
  ALIGN("align", 0x7c, 0x0000220, 0x0000220),//FIXME: new
  ALUIPC("aluic", 0xec, 0x001f000, 0x001f000),//FIXME: new
  CLO("clo", 0x00, 0x00000051, 0x001f0051),
  CLZ("clz", 0x00, 0x00000010, 0x001f0010),
  LA("la", 0x0, 0x0, 0x0),
  LI("li", 0x0, 0x0, 0x0),
  LUI("lui", 0x0, 0x0, 0x0),
  MOVE("move", 0x0, 0x0, 0x0),
  NEGU("negu", 0x0, 0x0, 0x0),
  SUB("sub", 0x0, 0x0, 0x0),
  SUBU("subu", 0x0, 0x0, 0x0),
  SEB("seb", 0x0, 0x0, 0x0),
  SEH("seh", 0x0, 0x0, 0x0),
  // SHIFT AND ROTATE OPERATIONS
  SLL("sll", 0x0, 0x0, 0x0),
  SLLV("sllv", 0x0, 0x0, 0x0),
  SRL("srl", 0x0, 0x0, 0x0),
  ROTR("rotr", 0x0, 0x0, 0x0),
  ROTRV("rotrv", 0x0, 0x0, 0x0),
  SRA("sra", 0x0, 0x0, 0x0),
  SRAV("srav", 0x0, 0x0, 0x0),
  SRLV("srlv", 0x0, 0x0, 0x0),
  // LOGICAL AND BIT-FIELD OPERATIONS
  AND("and", 0x00, 0x0000024, 0x00007e4),
  ANDI("andi", 0x30, 0x0, 0x0),
  AUI("aui", 0x3c, 0x0, 0x0),//FIXME: new
  AUIPC("andi", 0xec, 0x001e000, 0x001e000),//FIXME: new
  EXT("ext", 0x0, 0x0, 0x0),
  INS("ins", 0x0, 0x0, 0x0),
  NOP("nop", 0x0, 0x0, 0x0),
  NOR("nor", 0x0, 0x0, 0x0),
  NOT("not", 0x0, 0x0, 0x0),
  OR("or", 0x0, 0x0, 0x0),
  ORI("ori", 0x0, 0x0, 0x0),
  XOR("xor", 0x0, 0x0, 0x0),
  XORI("xori", 0x0, 0x0, 0x0),
  WSBH("wsbh", 0x0, 0x0, 0x0),
  // CONDITION TESTING AND CONDITIONAL MOVE OPERATIONS
  MOVN("movn", 0x0, 0x0, 0x0),
  MOVZ("movz", 0x0, 0x0, 0x0),
  SLT("slt", 0x0, 0x0, 0x0),
  SLTI("slti", 0x0, 0x0, 0x0),
  SLTIU("sltiu", 0x0, 0x0, 0x0),
  SLTU("sltu", 0x0, 0x0, 0x0),

  // MULTIPLY AND DIVIDE OPERATIONS
  DIV("div", 0x00, 0x0000009a, 0x0),
  MOD("div", 0x00, 0x000000da, 0x0),
  MUL("mul", 0x0, 0x0, 0x0),
  DIVU("divu", 0x00, 0x0000009b, 0x0),
  MODU("div", 0x00, 0x000000db, 0x0),
  MADD("madd", 0x0, 0x0, 0x0),
  MADDU("maddu", 0x0, 0x0, 0x0),
  MSUB("msub", 0x0, 0x0, 0x0),
  MSUBU("msubu", 0x0, 0x0, 0x0),
  MULT("mult", 0x0, 0x0, 0x0),
  MULTU("multu", 0x0, 0x0, 0x0),

  // JUMPS AND BRANCHES
  BEQ("beq", 0x1000000, 0x0, 0x0),
  BNE("bne", 0x14, 0x0, 0x0),
  BOVC("bovc", 0x20, 0x0, 0x0),
  BNVC("bnvc", 0x60, 0x0, 0x0),
  BREAK("break", 0x0, 0x000000d, 0x000000d),
  JAL("jal", 0x0, 0x0, 0x0),
  J("j", 0x0, 0x0, 0x0),
  JR("jr", 0x0, 0x0, 0x0),
  B("b", 0x10, 0x0, 0x03ff000),// assembly idiom actual instruction is BEQ r0, r0, offset
  BAL("bal", 0x04, 0x0011000, 0x03e1000),// assembly idiom actual instruction is BGEZAL r0, offset
  BALC("balc", 0xe8, 0x0, 0x0),//FIXME: new
  BC("bc", 0xc8, 0x0, 0x0),//FIXME: new
  BEQZ("beqz", 0x10, 0x0, 0x0),
  BGEZ("bgez", 0x04, 0x0001, 0x0),
  BGTZ("bgtz", 0x1c, 0x0, 0x001f000),
  BITSWAP("bitswap", 0x7c, 0x0000020, 0x03e07e0),//FIXME: new
  BGEZAL("bgezal", 0x0411000, 0x0000020, 0x0),//FIXME: removed in R6
  BLEZALC("blezalc", 0x18, 0x0, 0x0),//FIXME: new
  BGEZALC("bgezalc", 0x18, 0x0, 0x0),//FIXME: new
  BGTZALC("bgtzalc", 0x1c, 0x0, 0x0),//FIXME: new
  BLTZALC("bltzalc", 0x1c, 0x0, 0x0),//FIXME: new
  BEQZALC("beqzalc", 0x20, 0x0, 0x0),//FIXME: new
  BNEZALC("bnezalc", 0x60, 0x0, 0x0),//FIXME: new
  BLEZC("blezc", 0x58, 0x0, 0x03e0000),//FIXME: new
  BGEZC("bgezc", 0x58, 0x0, 0x0),//FIXME: new
  BGEC("bgec", 0x58, 0x0, 0x0),//FIXME: new
  BGTZC("bgtzc", 0x5c, 0x0, 0x03e0000),//FIXME: new
  BLTZC("bltzc", 0x5c, 0x0, 0x0),//FIXME: new
  BLTC("bltc", 0x5c, 0x0, 0x0),//FIXME: new
  BGEUC("bgeuc", 0x18, 0x0, 0x0),//FIXME: new
  BLTUC("bltuc", 0x1c, 0x0, 0x0),//FIXME: new
  BEQC("beqc", 0x20, 0x0, 0x0),//FIXME: new
  BNEC("bnec", 0x60, 0x0, 0x0),//FIXME: new
  BEQZC("beqzc", 0xd8, 0x0, 0x0),//FIXME: new
  BNEZC("bnezc", 0xf8, 0x0, 0x0),//FIXME: new
  BLEZ("blez", 0x18, 0x0, 0x001f000),
  BLTZ("bltz", 0x04, 0x0, 0x001f000),
  BNEZ("bnez", 0x0, 0x0, 0x0),
  BLTZAL("bltzal", 0x04, 0x0010000, 0x0010000),//FIXME: removed in R6
  JALR("jalr", 0x0, 0x0, 0x0),

  // LOAD AND STORE OPERATIONS
  LW("lw", 0x0, 0x0, 0x0),
  SW("sw", 0x0, 0x0, 0x0),
  LB("lb", 0x0, 0x0, 0x0),
  LBU("lbu", 0x0, 0x0, 0x0),
  LH("lh", 0x0, 0x0, 0x0),
  LHU("lhu", 0x0, 0x0, 0x0),
  LWL("lwl", 0x0, 0x0, 0x0),
  LWR("lwr", 0x0, 0x0, 0x0),
  SB("sb", 0x0, 0x0, 0x0),
  SH("sh", 0x0, 0x0, 0x0),
  SWL("swl", 0x0, 0x0, 0x0),
  SWR("swr", 0x0, 0x0, 0x0),
  ULW("ulw", 0x0, 0x0, 0x0),
  USW("usw", 0x0, 0x0, 0x0),
  CACHE("cache", 0x7c, 0x0000025, 0x0000065),
  CACHEE("cachee", 0x7c, 0x000001b, 0x000007b),

  // ACCUMULATOR ACCESS OPERATIONS
  MFHI("mfhi", 0x0, 0x0, 0x0),
  MFLO("mflo", 0x0, 0x0, 0x0),
  MTHI("mthi", 0x0, 0x0, 0x0),
  MTLO("mtlo", 0x0, 0x0, 0x0),

  // ATOMIC READ-MODIFY-WRITE OPERATIONS
  LL("ll", 0x0, 0x0, 0x0),
  SC("sc", 0x0, 0x0, 0x0),

  SYSCALL("syscall", 0x0, 0x0, 0x0),

  // Data transfer instructions
  LDC1("ldc1", 0x0, 0x0, 0x0),
  LWC1("lwc1", 0x0, 0x0, 0x0),
  SDC1("sdc1", 0x0, 0x0, 0x0),
  SWC1("swc1", 0x0, 0x0, 0x0),
  CFC1("cfc1", 0x44, 0x0040000, 0x00407ff),
  CFC2("cfc2", 0x48, 0x0040000, 0x0040000),
  CTC1("ctc1", 0x44, 0x00c00000, 0x0),
  CTC2("ctc2", 0x48, 0x00c00000, 0x0),
  MFC1("mfc1", 0x0, 0x0, 0x0),
  MFHC1("mfhc1", 0x0, 0x0, 0x0),
  MTC1("mtc1", 0x0, 0x0, 0x0),
  MTHC1("mthc1", 0x0, 0x0, 0x0),

  // FPU IEEE arithmetic operations
  ABS_S("abs.s", 0x44, 0x0200005, 0x021f005),
  ABS_D("abs.d", 0x44, 0x0220005, 0x023f005),
  ADD_S("add.s", 0x44, 0x0200000, 0x0200000),
  CMP_AF_S("cmp.af.s", 0x44, 0x02800000, 0x02800030),
  CMP_AF_D("cmp.af.d", 0x44, 0x02a00000, 0x02a00030),
  CMP_UN_S("cmp.un.s", 0x44, 0x02800001, 0x02800031),
  CMP_UN_D("cmp.un.d", 0x44, 0x02a00001, 0x0),
  CMP_EQ_S("cmp.eq.s", 0x44, 0x02800002, 0x02800032),
  CMP_EQ_D("cmp.eq.d", 0x44, 0x02a00002, 0x0),
  CMP_UEQ_S("cmp.ueq.s", 0x44, 0x02800003, 0x02800033),
  CMP_UEQ_D("cmp.ueq.d", 0x44, 0x02a00003, 0x0),
  CMP_LT_S("cmp.lt.s", 0x44, 0x02800004, 0x02800034),
  CMP_LT_D("cmp.lt.d", 0x44, 0x02a00004, 0x0),
  CMP_ULT_S("cmp.ult.s", 0x44, 0x02800005, 0x02800035),
  CMP_ULT_D("cmp.ult.d", 0x44, 0x02a00005, 0x0),
  CMP_LE_S("cmp.le.s", 0x44, 0x02800006, 0x02800036),
  CMP_LE_D("cmp.le.d", 0x44, 0x02a000006, 0x0),
  CMP_ULE_S("cmp.ule.s", 0x44, 0x02800007, 0x02800037),
  CMP_ULE_D("cmp.ule.d", 0x44, 0x02a00007, 0x0),
  CMP_SAF_S("cmp.saf.s", 0x44, 0x02800008, 0x02800038),
  CMP_SAF_D("cmp.saf.d", 0x44, 0x02a00008, 0x0),
  CMP_SUN_S("cmp.sun.s", 0x44, 0x02800009, 0x02800039),
  CMP_SUN_D("cmp.sun.d", 0x44, 0x02a00009, 0x02a00039),
  CMP_SEQ_S("cmp.seq.s", 0x44, 0x0280000a, 0x0280003a),
  CMP_SEQ_D("cmp.seq.d", 0x44, 0x02a0000a, 0x02a0003a),
  CMP_SUEQ_S("cmp.sueq.s", 0x44, 0x0280000b, 0x0280003b),
  CMP_SUEQ_D("cmp.sueq.d", 0x44, 0x02a0000b, 0x02a0003b),
  CMP_SLT_S("cmp.slt.s", 0x44, 0x0280000c, 0x0280003c),
  CMP_SLT_D("cmp.slt.d", 0x44, 0x02a0000c, 0x02a0003c),
  CMP_SULT_S("cmp.sult.s", 0x44, 0x0280000d, 0x0280003d),
  CMP_SULT_D("cmp.sult.d", 0x44, 0x02a0000d, 0x02a0003d),
  CMP_SLE_S("cmp.sle.s", 0x44, 0x0280000e, 0x0280003e),
  CMP_SLE_D("cmp.sle.d", 0x44, 0x02a0000e, 0x02a0003e),
  CMP_SULE_S("cmp.sule.s", 0x44, 0x0280000f, 0x0280003f),
  CMP_SULE_D("cmp.sule.d", 0x44, 0x02a0000f, 0x02a0003f),
  CMP_AT_S("cmp.at.s", 0x44, 0x02800010, 0x0),
  CMP_AT_D("cmp.at.d", 0x44, 0x02a00010, 0x0),
  CMP_OR_S("cmp.or.s", 0x44, 0x02800011, 0x0),
  CMP_OR_D("cmp.or.d", 0x44, 0x02a00011, 0x0),
  CMP_UNE_S("cmp.une.s", 0x44, 0x02800012, 0x0),
  CMP_UNE_D("cmp.une.d", 0x44, 0x02a00012, 0x0),
  CMP_NE_S("cmp.ne.s", 0x44, 0x02800013, 0x0),
  CMP_NE_D("cmp.ne.d", 0x44, 0x02a00013, 0x0),
  CMP_UGE_S("cmp.uge.s", 0x44, 0x02800014, 0x0),
  CMP_UGE_D("cmp.uge.d", 0x44, 0x02a00014, 0x0),
  CMP_OGE_S("cmp.oge.s", 0x44, 0x02800015, 0x0),
  CMP_OGE_D("cmp.oge.d", 0x44, 0x02a00015, 0x0),
  CMP_UGT_S("cmp.ugt.s", 0x44, 0x02800016, 0x0),
  CMP_UGT_D("cmp.ugt.d", 0x44, 0x02a00016, 0x0),
  CMP_OGT_S("cmp.ogt.s", 0x44, 0x02800017, 0x0),
  CMP_OGT_D("cmp.ogt.d", 0x44, 0x02a00017, 0x0),
  CMP_SAT_S("cmp.sat.s", 0x44, 0x02800018, 0x0),
  CMP_SAT_D("cmp.sat.d", 0x44, 0x02a00018, 0x0),
  CMP_SOR_S("cmp.sor.s", 0x44, 0x02800019, 0x0),
  CMP_SOR_D("cmp.sor.d", 0x44, 0x02a00019, 0x0),
  CMP_SUNE_S("cmp.sune.s", 0x44, 0x0280001a, 0x0),
  CMP_SUNE_D("cmp.sune.d", 0x44, 0x02a0001a, 0x0),
  CMP_SNE_S("cmp.sne.s", 0x44, 0x0280001b, 0x0),
  CMP_SNE_D("cmp.sne.d", 0x44, 0x02a0001b, 0x0),
  CMP_SUGE_S("cmp.suge.s", 0x44, 0x0280001c, 0x0),
  CMP_SUGE_D("cmp.suge.d", 0x44, 0x02a0001c, 0x0),
  CMP_SOGE_S("cmp.soge.s", 0x44, 0x0280001d, 0x0),
  CMP_SOGE_D("cmp.soge.d", 0x44, 0x02a0001d, 0x0),
  CMP_SUGT_S("cmp.sugt.s", 0x44, 0x0280001e, 0x0),
  CMP_SUGT_D("cmp.sugt.d", 0x44, 0x02a0001e, 0x0),
  CMP_SOGT_S("cmp.sogt.s", 0x44, 0x0280001f, 0x0),
  CMP_SOGT_D("cmp.sogt.d", 0x44, 0x02a0001f, 0x0),
  COP2("cop2",0x48,0x02000000,0x0),
  CRC32B("crc32b",0x7c,0x0000000f,0x0),
  CRC32H("crc32h",0x7c,0x0000004f,0x0),
  CRC32W("crc32w",0x7c,0x0000008f,0x0),
  CRC32CB("crc32cb",0x7c,0x0000010f,0x0),
  CRC32CH("crc32ch",0x7c,0x0000014f,0x0),
  CRC32CW("crc32cw",0x7c,0x0000018f,0x0),
  DIV_S("div.s", 0x0, 0x0, 0x0),
  DIV_D("div.d", 0x0, 0x0, 0x0),
  MUL_S("mul.s", 0x0, 0x0, 0x0),
  MUL_D("mul.d", 0x0, 0x0, 0x0),
  NEG_S("neg.s", 0x0, 0x0, 0x0),
  NEG_D("neg.d", 0x0, 0x0, 0x0),
  SQRT_S("sqrt.s", 0x0, 0x0, 0x0),
  SQRT_D("sqrt.d", 0x0, 0x0, 0x0),
  SUB_S("sub.s", 0x0, 0x0, 0x0),
  SUB_D("sub.d", 0x0, 0x0, 0x0),

  // FPU non-IEEE-approximate Arithmetic Instructions
  RECIP_S("recip.s", 0x0, 0x0, 0x0),
  RECIP_D("recip.d", 0x0, 0x0, 0x0),
  RSQRT_S("rsqrt.s", 0x0, 0x0, 0x0),
  RSQRT_D("rsqrt.d", 0x0, 0x0, 0x0),

  // FPU Fused Multiply-Accumulate Arithmetic Operations (Release 6)
  MADDF_S("maddf.s", 0x0, 0x0, 0x0),
  MADDF_D("maddf.d", 0x0, 0x0, 0x0),
  MSUBF_S("msubf.s", 0x0, 0x0, 0x0),
  MSUBF_D("msubf.d", 0x0, 0x0, 0x0),

  // Floating Point Comparison Instructions
  CLASS_S("class.s", 0x44, 0x0200001b, 0x021f001b),
  CLASS_D("class.d", 0x44, 0x0220001b, 0x023f001b),
  MAX_S("max.s", 0x0, 0x0, 0x0),
  MAX_D("max.d", 0x0, 0x0, 0x0),
  MAXA_S("maxa.s", 0x0, 0x0, 0x0),
  MAXA_D("maxa.d", 0x0, 0x0, 0x0),
  MIN_S("min.s", 0x0, 0x0, 0x0),
  MIN_D("min.d", 0x0, 0x0, 0x0),
  MINA_S("mina.s", 0x0, 0x0, 0x0),
  MINA_D("mina.d", 0x0, 0x0, 0x0),

  // FPU Conversion Operations Using the FCSR Rounding Mode
  CVT_D_S("cvt.d.s", 0x44, 0x02000021, 0x0),
  CVT_D_W("cvt.d.w", 0x44, 0x02800021, 0x0),
  CVT_D_L("cvt.d.l", 0x44, 0x02a00021, 0x0),
  CVT_L_S("cvt.l.s", 0x44, 0x02000025, 0x0),
  CVT_L_D("cvt.l.d", 0x44, 0x02200025, 0x0),
  CVT_S_D("cvt.s.d", 0x44, 0x02200020, 0x0),
  CVT_S_W("cvt.s.w", 0x44, 0x02800020, 0x0),
  CVT_S_L("cvt.s.l", 0x44, 0x02a00020, 0x0),
  CVT_W_S("cvt.w.s", 0x44, 0x02000024, 0x0),
  CVT_W_D("cvt.w.d", 0x44, 0x0220002, 0x0),
  RINT_S("rint.s", 0x0, 0x0, 0x0),
  RINT_D("rint.d", 0x0, 0x0, 0x0),

  // FPU Conversion Operations Using a Directed Rounding Mode
  CEIL_L_S("ceil.l.s", 0x44, 0x020000a, 0x021f00a),
  CEIL_L_D("ceil.l.d", 0x44, 0x022000a, 0x023f00a),
  CEIL_W_S("ceil.w.s", 0x44, 0x020000e, 0x021f00e),
  CEIL_W_D("ceil.w.d", 0x44, 0x022000e, 0x023f00e),
  FLOOR_L_S("floor.l.s", 0x0, 0x0, 0x0),
  FLOOR_L_D("floor.l.d", 0x0, 0x0, 0x0),
  FLOOR_W_S("floor.w.s", 0x0, 0x0, 0x0),
  FLOOR_W_D("floor.w.d", 0x0, 0x0, 0x0),
  ROUND_L_S("round.l.s", 0x0, 0x0, 0x0),
  ROUND_L_D("round.l.d", 0x0, 0x0, 0x0),
  ROUND_W_S("round.w.s", 0x0, 0x0, 0x0),
  ROUND_W_D("round.w.d", 0x0, 0x0, 0x0),
  TRUNC_L_S("trunc.l.s", 0x0, 0x0, 0x0),
  TRUNC_L_D("trunc.l.d", 0x0, 0x0, 0x0),
  TRUNC_W_S("trunc.w.s", 0x0, 0x0, 0x0),
  TRUNC_W_D("trunc.w.d", 0x0, 0x0, 0x0),

  // FPU Formatted Unconditional Operand Move Instructions
  MOV_S("mov.s", 0x0, 0x0, 0x0),
  MOV_D("mov.d", 0x0, 0x0, 0x0),

  // FPU Conditional Select Instructions
  SEL_S("sel.s", 0x0, 0x0, 0x0),
  SEL_D("sel.d", 0x0, 0x0, 0x0),
  SELEQZ_S("seleqz.s", 0x0, 0x0, 0x0),
  SELEQZ_D("seleqz.d", 0x0, 0x0, 0x0),
  SELNEZ_S("selnez.s", 0x0, 0x0, 0x0),
  SELNEZ_D("selnez.d", 0x0, 0x0, 0x0),

  // FPU Conditional Branch Instructions
  BC1EQZ("bc1eqz", 0x44, 0x0120000, 0x0),
  BC1NEZ("bc1nez", 0x44, 0x01a0000, 0x0),
  BC2EQZ("bc2eqz", 0x48, 0x0120000, 0x0),
  BC2NEZ("bc2nez", 0x48, 0x01a0000, 0x0),

  // System utilities
  DERET("deret", 0x40, 0x0200001f, 0x0),
  DI("di", 0x40, 0x01606000, 0x0),

  ;

  private final String name;

  private final int opcode;

  private final int rule;

  private final int ruleMask;

  Opcode(String name, int opcode, int rule, int ruleMask) {
    this.name = name;
    this.opcode = opcode;
    this.rule = rule;
    this.ruleMask = ruleMask;
  }

  public static final Map<Integer, Opcode> OPCODES = Arrays.stream(Opcode.values())
      .collect(Collectors.toMap(opcode -> opcode.rule, Function.identity()));
}
